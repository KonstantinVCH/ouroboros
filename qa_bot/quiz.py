"""QA Bot ‚Äî quiz module. Interactive theory quizzes for QA engineers."""

import random

# Question bank: (question, options A/B/C/D, correct_answer, explanation)
QUIZ_BANK = [
    (
        "–ß—Ç–æ —Ç–∞–∫–æ–µ smoke testing?",
        ["A) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏", "B) –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å–∏—Å—Ç–µ–º—ã",
         "C) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", "D) –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"],
        "B",
        "Smoke test ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≥–æ, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç, "
        "–ø—Ä–µ–∂–¥–µ —á–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é."
    ),
    (
        "–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç regression testing?",
        ["A) –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª", "B) –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã",
         "C) –ß—Ç–æ —Å—Ç–∞—Ä—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ —Å–ª–æ–º–∞–ª—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π",
         "D) –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö"],
        "C",
        "–†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤ –∏–ª–∏ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ "
        "–Ω–µ —Å–ª–æ–º–∞–ª–∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª."
    ),
    (
        "–ß—Ç–æ —Ç–∞–∫–æ–µ test case?",
        ["A) –û—Ç—á—ë—Ç –æ –±–∞–≥–µ", "B) –ù–∞–±–æ—Ä —à–∞–≥–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏",
         "C) –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç", "D) –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫ –ø—Ä–æ–¥—É–∫—Ç—É"],
        "B",
        "–¢–µ—Å—Ç-–∫–µ–π—Å ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä —à–∞–≥–æ–≤, —É—Å–ª–æ–≤–∏–π –∏ –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ "
        "–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏."
    ),
    (
        "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è?",
        ["A) –ò–µ—Ä–∞—Ä—Ö–∏—è –±–∞–≥–æ–≤ –ø–æ severity", "B) –ú–µ—Ç–æ–¥ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞",
         "C) –ú–æ–¥–µ–ª—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤: –º–Ω–æ–≥–æ unit, –º–µ–Ω—å—à–µ integration, –º–∞–ª–æ E2E",
         "D) –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ–ª–∏–∑–∞"],
        "C",
        "–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –∫–æ–Ω—Ü–µ–ø—Ü–∏—è, –≥–¥–µ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –±—ã—Å—Ç—Ä—ã–µ unit-—Ç–µ—Å—Ç—ã, "
        "—Å–µ—Ä–µ–¥–∏–Ω—É ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ, –∞ –≤–µ—Ä—à–∏–Ω—É ‚Äî –º–µ–¥–ª–µ–Ω–Ω—ã–µ E2E-—Ç–µ—Å—Ç—ã."
    ),
    (
        "–ß—Ç–æ —Ç–∞–∫–æ–µ severity –±–∞–≥–∞?",
        ["A) –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "B) –í–ª–∏—è–Ω–∏–µ –±–∞–≥–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É",
         "C) –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è", "D) –ö—Ç–æ –Ω–∞—à—ë–ª –±–∞–≥"],
        "B",
        "Severity ‚Äî —ç—Ç–æ —Å—Ç–µ–ø–µ–Ω—å –≤–ª–∏—è–Ω–∏—è –±–∞–≥–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã (–∫—Ä–∏—Ç–∏—á–Ω—ã–π, –≤—ã—Å–æ–∫–∏–π, —Å—Ä–µ–¥–Ω–∏–π, –Ω–∏–∑–∫–∏–π). "
        "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (priority) ‚Äî —ç—Ç–æ —Ç–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å—Ä–æ—á–Ω–æ –µ–≥–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å."
    ),
    (
        "–ß—Ç–æ —Ç–∞–∫–æ–µ boundary value analysis?",
        ["A) –ê–Ω–∞–ª–∏–∑ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö",
         "B) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
         "C) –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π", "D) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–≥—Ä–∞–Ω–∏—Ü"],
        "A",
        "BVA ‚Äî —Ç–µ—Ö–Ω–∏–∫–∞ —Ç–µ—Å—Ç-–¥–∏–∑–∞–π–Ω–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ "
        "–¥–∏–∞–ø–∞–∑–æ–Ω–∞, —Ç–∞–∫ –∫–∞–∫ –∏–º–µ–Ω–Ω–æ —Ç–∞–º —á–∞—â–µ –≤—Å–µ–≥–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –æ—à–∏–±–∫–∏."
    ),
    (
        "–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç API —Ç–µ—Å—Ç?",
        ["A) –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞", "B) –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã",
         "C) –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü", "D) –ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"],
        "B",
        "API-—Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å—ã –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º, "
        "–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—É—Å-–∫–æ–¥—ã, —Å—Ö–µ–º—ã –æ—Ç–≤–µ—Ç–æ–≤ –∏ –¥–∞–Ω–Ω—ã–µ."
    ),
    (
        "–ß—Ç–æ —Ç–∞–∫–æ–µ black box testing?",
        ["A) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∑–Ω–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–¥–∞",
         "B) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",
         "C) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞",
         "D) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"],
        "A",
        "Black box ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã, –Ω–µ –∑–Ω–∞—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π "
        "—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –§–æ–∫—É—Å –Ω–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö."
    ),
    (
        "–ß—Ç–æ —Ç–∞–∫–æ–µ exploratory testing?",
        ["A) –¢–µ—Å—Ç –ø–æ –≥–æ—Ç–æ–≤—ã–º —Å–∫—Ä–∏–ø—Ç–∞–º", "B) –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
         "C) –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∑–∞—Ä–∞–Ω–µ–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤",
         "D) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"],
        "C",
        "Exploratory testing ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑—É—á–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç, –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç –∏ "
        "–≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–µ—Å—Ç—ã. –•–æ—Ä–æ—à–æ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –±–∞–≥–∏."
    ),
    (
        "–ß—Ç–æ —Ç–∞–∫–æ–µ test plan?",
        ["A) –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤", "B) –î–æ–∫—É–º–µ–Ω—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –æ–±—ä—ë–º–∞ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
         "C) –û—Ç—á—ë—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è", "D) –ì—Ä–∞—Ñ–∏–∫ —Ä–µ–ª–∏–∑–æ–≤"],
        "B",
        "Test Plan ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç —á—Ç–æ, –∫–∞–∫, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å. "
        "–í–∫–ª—é—á–∞–µ—Ç: —Ü–µ–ª–∏, –æ–±—ä—ë–º, —Ä–∏—Å–∫–∏, —Ä–µ—Å—É—Ä—Å—ã, –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è."
    ),
]


class QuizSession:
    """Manages a single user's quiz session."""

    def __init__(self):
        self.questions = random.sample(QUIZ_BANK, min(5, len(QUIZ_BANK)))
        self.current = 0
        self.score = 0
        self.answers: list[tuple[str, str, bool]] = []

    def current_question(self) -> str:
        """Return formatted current question."""
        q, options, _, _ = self.questions[self.current]
        opts = "\n".join(options)
        return (f"‚ùì –í–æ–ø—Ä–æ—Å {self.current + 1}/{len(self.questions)}:\n\n"
                f"*{q}*\n\n{opts}\n\n–û—Ç–≤–µ—Ç—å: A, B, C –∏–ª–∏ D")

    def answer(self, user_answer: str) -> str:
        """Process user answer, return feedback."""
        q, options, correct, explanation = self.questions[self.current]
        user_answer = user_answer.strip().upper()

        if user_answer not in ("A", "B", "C", "D"):
            return "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å: A, B, C –∏–ª–∏ D"

        is_correct = user_answer == correct
        if is_correct:
            self.score += 1

        self.answers.append((q, user_answer, is_correct))
        self.current += 1

        feedback = "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!" if is_correct else f"‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {correct}"
        result = f"{feedback}\n\nüìñ {explanation}"

        if self.current < len(self.questions):
            result += "\n\n" + self.current_question()
        else:
            result += "\n\n" + self.summary()

        return result

    def summary(self) -> str:
        """Return final quiz summary."""
        pct = int(self.score / len(self.questions) * 100)
        emoji = "üèÜ" if pct >= 80 else "üìö" if pct >= 50 else "üí™"
        return (f"{emoji} –ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω!\n"
                f"–†–µ–∑—É–ª—å—Ç–∞—Ç: {self.score}/{len(self.questions)} ({pct}%)\n\n"
                f"–î–ª—è –Ω–æ–≤–æ–≥–æ –∫–≤–∏–∑–∞ ‚Äî /quiz\n"
                f"–î—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã ‚Äî /help")

    @property
    def is_finished(self) -> bool:
        return self.current >= len(self.questions)
